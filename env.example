# ============================================================================
# MIMIR CONFIGURATION
# ============================================================================
# Copy this file to .env and customize as needed
# Most settings have sensible defaults - only change what you need

# ============================================================================
# REQUIRED SETTINGS
# ============================================================================

# Mimir Server Configuration
MIMIR_SERVER_URL=http://localhost:9042    # Mimir HTTP server URL (used by clients)
MIMIR_SERVER_PORT=9042                     # Port for Mimir HTTP server

# Neo4j Database Password (CHANGE THIS IN PRODUCTION!)
NEO4J_PASSWORD=password

# Your main source code directory (will be mounted read-only)
# Examples:
#   Windows: C:\Users\YourName\Documents\GitHub
#   macOS:   ~/Documents/projects
#   Linux:   ~/workspace
HOST_WORKSPACE_ROOT=~/src

# ============================================================================
# LLM CONFIGURATION (For Chat API & Orchestration)
# ============================================================================

# Provider Selection
MIMIR_DEFAULT_PROVIDER=openai        # Options: openai, copilot, ollama, llama.cpp
MIMIR_DEFAULT_MODEL=gpt-4.1          # Default LLM model

# LLM API Configuration (simple concatenation: MIMIR_LLM_API + MIMIR_LLM_API_PATH)
# Pattern 1: Base includes version prefix
MIMIR_LLM_API=http://copilot-api:4141/v1
MIMIR_LLM_API_PATH=/chat/completions
MIMIR_LLM_API_MODELS_PATH=/models
MIMIR_LLM_API_KEY=dummy-key-for-proxy

# Pattern 2: Path includes version prefix (also valid)
# MIMIR_LLM_API=http://copilot-api:4141
# MIMIR_LLM_API_PATH=/v1/chat/completions
# MIMIR_LLM_API_MODELS_PATH=/v1/models

# For OpenAI direct (Pattern 1):
# MIMIR_LLM_API=https://api.openai.com/v1
# MIMIR_LLM_API_PATH=/chat/completions
# MIMIR_LLM_API_MODELS_PATH=/models
# MIMIR_LLM_API_KEY=sk-...your-openai-api-key...

# ============================================================================
# PCTX Integration (Code Mode for 90-98% token reduction)
# ============================================================================
# PCTX URL (default: http://localhost:8080 for local, http://host.docker.internal:8080 for Docker)
PCTX_URL=http://localhost:8080
# Enable/disable PCTX tool for agents (default: false)
PCTX_ENABLED=false

# ============================================================================
# AUTHENTICATION & SECURITY (Optional - disabled by default)
# ============================================================================
# Enable authentication (default: false)
# When true: Users must authenticate to access Mimir
# When false: No authentication required (development only)
MIMIR_ENABLE_SECURITY=false

# Enable Role-Based Access Control (default: false)
# Requires MIMIR_ENABLE_SECURITY=true
# When true: Fine-grained permissions based on user roles
# When false: All authenticated users get full access
MIMIR_ENABLE_RBAC=false

# RBAC Configuration (optional)
# Supports 3 formats:
# 1. Local file path: MIMIR_RBAC_CONFIG=./config/rbac.json
# 2. Remote URI: MIMIR_RBAC_CONFIG=https://config-server.example.com/rbac.json
# 3. Inline JSON: MIMIR_RBAC_CONFIG='{"version":"1.0","claimPath":"roles",...}'
# MIMIR_RBAC_CONFIG=./config/rbac.json

# Authorization header for remote RBAC config (optional)
# Use with remote URI to authenticate config requests
# MIMIR_RBAC_AUTH_HEADER=Bearer your-token-here


# Multiple dev users for RBAC testing (recommended):
# Format: MIMIR_DEV_USER_<NAME>=username:password:role1,role2,role3
# Examples:
# MIMIR_DEV_USER_ADMIN=admin:admin:admin,developer,analyst
# MIMIR_DEV_USER_DEVELOPER=dev:dev:developer
# MIMIR_DEV_USER_ANALYST=analyst:analyst:analyst
# MIMIR_DEV_USER_VIEWER=viewer:viewer:viewer

# JWT Secret for signing authentication tokens (REQUIRED when MIMIR_ENABLE_SECURITY=true)
# IMPORTANT: Changing this will invalidate all existing tokens
# JWT tokens expire after 90 days (hardcoded in auth-api.ts)
MIMIR_JWT_SECRET=change-me-in-production

# ============================================================================
# PHASE 2: AUDIT LOGGING & DATA RETENTION
# ============================================================================

# Audit Logging (disabled by default)
# Generic audit trail for compliance (HIPAA, FISMA, GDPR)
MIMIR_ENABLE_AUDIT_LOGGING=false

# Audit log destination: stdout, file, webhook, or all
MIMIR_AUDIT_LOG_DESTINATION=stdout

# Audit log format: json or text
MIMIR_AUDIT_LOG_FORMAT=json

# Audit log level: info, debug, warn, error
MIMIR_AUDIT_LOG_LEVEL=info

# Audit log file path (if destination=file or all)
# MIMIR_AUDIT_LOG_FILE=/var/log/mimir/audit.log

# Webhook URL for audit events (if destination=webhook or all)
# MIMIR_AUDIT_WEBHOOK_URL=https://siem.example.com/ingest
# MIMIR_AUDIT_WEBHOOK_AUTH_HEADER=Bearer your-token-here

# Webhook batching (optional)
# MIMIR_AUDIT_WEBHOOK_BATCH_SIZE=100
# MIMIR_AUDIT_WEBHOOK_BATCH_INTERVAL_MS=5000

# Data Retention (disabled by default - data kept forever)
# Enable automatic deletion of old data
MIMIR_DATA_RETENTION_ENABLED=false

# Default retention in days (0 = forever, default)
# Only applies when MIMIR_DATA_RETENTION_ENABLED=true
MIMIR_DATA_RETENTION_DEFAULT_DAYS=0

# Node-specific retention policies (JSON format)
# Example: {"todo":30,"memory":365,"audit":2555}
# MIMIR_DATA_RETENTION_POLICIES={"todo":30,"memory":90}

# Audit log retention in days (0 = forever, default)
# HIPAA requires 7 years (2555 days) for audit logs
MIMIR_DATA_RETENTION_AUDIT_DAYS=0

# How often to run cleanup (milliseconds, default: 24 hours)
# MIMIR_DATA_RETENTION_INTERVAL_MS=86400000

# OAuth Configuration (for production)
# MIMIR_AUTH_PROVIDER=okta
# MIMIR_OAUTH_ISSUER=https://your-domain.okta.com  # Internal URL for server-to-server (use host.docker.internal for local OAuth)
# MIMIR_OAUTH_ISSUER_PUBLIC=https://your-domain.okta.com  # Public URL for browser redirects (optional, defaults to MIMIR_OAUTH_ISSUER)
# MIMIR_OAUTH_CLIENT_ID=your-client-id
# MIMIR_OAUTH_CLIENT_SECRET=your-client-secret
# MIMIR_OAUTH_CALLBACK_URL=http://localhost:9042/auth/oauth/callback
# MIMIR_OAUTH_USERINFO_URL=https://your-domain.okta.com/oauth2/v1/userinfo  # Optional, defaults to {ISSUER}/oauth2/v1/userinfo
# MIMIR_OAUTH_TIMEOUT_MS=10000  # Optional, timeout for OAuth userinfo requests in milliseconds (default: 10000ms = 10s)

# ============================================================================
# EMBEDDINGS CONFIGURATION (For Semantic Search & RAG)
# ============================================================================

# Enable/disable embeddings
MIMIR_EMBEDDINGS_ENABLED=true

# Embedding Model Configuration
MIMIR_EMBEDDINGS_MODEL=mxbai-embed-large     # Default: mxbai-embed-large (1024 dims)
MIMIR_EMBEDDINGS_API=http://llama-server:8080
MIMIR_EMBEDDINGS_API_PATH=/v1/embeddings
MIMIR_EMBEDDINGS_DIMENSIONS=1024             # Default: 1024 for mxbai-embed-large
MIMIR_EMBEDDINGS_CHUNK_SIZE=768              # Default: 768
MIMIR_EMBEDDINGS_CHUNK_OVERLAP=50            # Default: 50
MIMIR_EMBEDDINGS_MAX_RETRIES=3               # Default: 3 (retries for 503/model loading errors)
MIMIR_EMBEDDINGS_DELAY_MS=500                # Default: 500ms (delay between files to prevent overwhelming Ollama)

# Indexing Configuration
MIMIR_INDEXING_THREADS=1                     # Default: 1 (concurrent folders to index, limited due to single Ollama instance)

# ============================================================================
# OPTIONAL: ADVANCED FEATURES
# ============================================================================

# Auto-index Mimir documentation on startup (default: true)
# This allows users to immediately query Mimir's docs via semantic search
MIMIR_AUTO_INDEX_DOCS=true

# Per-agent model overrides (optional - defaults to MIMIR_DEFAULT_MODEL)
# MIMIR_PM_MODEL=gpt-4.1               # PM agent model
# MIMIR_WORKER_MODEL=gpt-4o-mini       # Worker agent model  
# MIMIR_QC_MODEL=gpt-4.1               # QC agent model

# Enable Ecko prompt optimization agent
MIMIR_ENABLE_ECKO=false

# Enable PM model suggestions
MIMIR_FEATURE_PM_MODEL_SUGGESTIONS=false

# ============================================================================
# OPTIONAL: CORPORATE NETWORK SETTINGS
# ============================================================================
# Only needed if you're behind a corporate proxy or use custom certificates

# Proxy settings (uncomment if needed)
# HTTP_PROXY=http://proxy.company.com:8080
# HTTPS_PROXY=http://proxy.company.com:8080
# NO_PROXY=localhost,127.0.0.1

# HTTP server port
PORT=3000

# File watching configuration
FILE_WATCH_POLLING=true
FILE_WATCH_INTERVAL=1000
WORKSPACE_ROOT=/workspace

# Custom CA certificates (uncomment if needed)
# SSL_CERT_FILE=/path/to/corporate-ca.crt
# CURL_CA_BUNDLE=/path/to/corporate-ca.crt
